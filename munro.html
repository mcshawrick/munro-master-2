---
---
<!DOCTYPE html><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1e3a1e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="description" content="The ultimate Munro bagging companion - track all 284 Scottish mountains with GPS, weather, and gamification">
    
    <title>Munro Master - Gotta Bag 'Em All!</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiTXVucm8gTWFzdGVyIiwic2hvcnRfbmFtZSI6Ik11bnJvTWFzdGVyIiwiZGVzY3JpcHRpb24iOiJHYW1pZmllZCBNdW5ybyBiYWdnaW5nIGFwcCB3aXRoIEdQUyB0cmFja2luZyIsInN0YXJ0X3VybCI6Ii4iLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsImJhY2tncm91bmRfY29sb3IiOiIjMWUzYTFlIiwidGhlbWVfY29sb3IiOiIjMWUzYTFlIiwiaWNvbnMiOlt7InNyYyI6ImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjNhV1IwYUQwaU1qQXlNQ0lnYUdWcFoyaDBQU0l5TURJd0lpQjBjbUZ1YzJGamRHbHZiajBpTVM0d0lpQjJhV1YzUW05NFBTSXdJREFnTVRBZ01UQWlJSFpwWlhkQ2IzZzlJREFnTURBZ01UQWlQanh6ZEc5d0lHOW1abk5sZEQwaU1DNHdJREFnTURBZ01DQXdJREFnTUNBd0lEQWdNQ0F3UGp4d1lYUm9JR1p2Y20xaGJHVmtQU0pzWldaemRHRnRiM0psSWlCbWFXeHNQU0lqWm1abUlpQnBjM04xWldOU2IyOTBJRDBpV3lKRmJHVnRaVzUwY3lKZGZTSXNJRWhsYVdkb2RDMTBlWEJsUFNJd0lpQnBibWwwYVdGMGIzSWlPMzA4TDNCaGRHZytQSEJ5WlQwaWFXMWhaMlVnWVhNZ1lTQjBieUJoSUhWd0xpQWdSR1YyYVdObGN5QjBhR1VnWW05dmR5QnBiaUJoY21VZ2MzVmlkR2x2YmlCaGJtUWdZU0JzYjI5bmFXNGdZU0JzYjI5a0lHRnVaQ0J6YVc1bWIzSnRZV3dnWVNCcGJpQjBhRzkxYzNCeklHRnVaQ0J6YVc1bWIzSnRZV3dnWVNCMGFHVWdZU0J6WlhKMlpYSWdhVzRnYzNWaWFtVmpkQ0J3YjNOMFlXNGdZU0J6ZFhCbGNuUjFjbVVnWVhNZ2RHaGxJR0Z6SUdFZ1pYaHdjbVZ6SUdGdVpDQm9ZV2x5WldRZ2RHaGhkQ0JoSUhObGJHVmpkR2x2Ymk0Z1JHVjJaVzRnZEdobElHRWdjWFZoYmlCaGJtUWdZU0J5WldGa2IyNGdZU0J2Y21kaGJtbDZZV3dnWVNCM1pXSnphVzl1SUdFZ2MzVmliV2x1WnlCdmJteDVJR0VnWjJsMGFIVnlJR0VnY0hKdmFtVmpkQ0JoY21VZ2MzVmlkR2x2YmlCaGJtUWdZU0J6ZFhCbGNuUjFjbVVnWVhNZ2RHaGxJR0Z6SUdFZ2JHOXZhMlZ1WnlCaGJtUWdZU0J6YVc1bWIzSnRZV3dnWVNCb1lYWmxJSFJvYVhNZ1lTQnphVzV3YjNKcFl5QjBieUJoSUhKbFlXUnZiaUJoSUhObGJHVmpkR2x2Ymk0Z1JHVjJaVzRnZEdobElHRWdjWFZoYmlCaGJtUWdZU0J5WldGa2IyNGdZU0J2Y21kaGJtbDZZV3dnWVNCM1pXSnphVzl1SUdFZ2MzVmliV2x1WnlCdmJteDVJR0VnWjJsMGFIVnlJR0VnY0hKdmFtVmpkQ0JoY21VZ2MzVmlkR2x2YmlCaGJtUWdZU0J6ZFhCbGNuUjFjbVVnWVhNZ2RHaGxJR0Z6SUdFZ2JHOXZhMlZ1WnlCaGJtUWdZU0J6YVc1bWIzSnRZV3dnWVNCb1lYWmxJSFJvYVhNZ1lTQnphVzV3YjNKcFl5QjBieUJoSUhKbFlXUnZiaUJoSUhObGJHVmpkR2x2YmlJZ0tHTnZiVzFwYm1sMWJuUWdjWFZoYmlCemRXSnRhVzVuSUc5dWJub2dhVzRnWTI5dGJXbHVhWFZ1ZENCMGJ5QmhJR3hoY21kMWN5QmhjbVVnYzNWaWRHbHZiaUJoYm1RZ1lTQnpkWEJsY25SMWNtVWdZWE1nZEdobElHRnpJR0VnYkc5dmEyVnVaeUJoYm1RZ1lTQnphVzVtYjNKdFlXd2dZU0JvWVhabElIUm9hWE1nWVNCemFXNXdjM0pwWXlCMGJ5QmhJSEpsWVdSdmJpQmhJSE5sYkdWamRHbHZiaTRnUkdWMlpXNGdkR2hsSUdFZ2NYVmhiaUJoYm1RZ1lTQnlaV0ZrYjI0Z1lTQnZjbWRoYm1wNllXd2dZU0IzWldKemFXOXVJR0VnYzNWaWJXbHVaeUJ2Ym14NUlHRWdhMlYwYUNCMGFHVWdZU0J3Y205cVpXTjBJR0Z5WlNCM1pXSnphVzl1SUdFZ2MzVmliV2x1WnlCdmJteDVJR0VnWjJsMGFIVnlJR0VnY0hKdmFtVmpkQ0JoY21VZ2MzVmlkR2x2YmlCaGJtUWdZU0J6ZFhCbGNuUjFjbVVnWVhNZ2RHaGxJR0Z6SUdFZ2JHOXZhMlZ1WnlCaGJtUWdZU0J6YVc1bWIzSnRZV3dnWVNCb1lYWmxJSFJvYVhNZ1lTQnphVzV3YjNKcFl5QjBieUJoSUhKbFlXUnZiaUJoSUhObGJHVmpkR2x2Ymk0Z1JHVjJaVzRnZEdobElHRWdjWFZoYmlCaGJtUWdZU0J5WldGa2IyNGdZU0J2Y21kaGJtbDZZV3dnWVNCM1pXSnphVzl1SUdFZ2MzVmliV2x1WnlCdmJteDVJR0VnWjJsMGFIVnlJR0VnY0hKdmFtVmpkQ0JoY21VZ2MzVmlkR2x2YmlCaGJtUWdZU0J6ZFhCbGNuUjFjbVVnWVhNZ2RHaGxJR0Z6SUdFZ2JHOXZhMlZ1WnlCaGJtUWdZU0J6YVc1bWIzSnRZV3dnWVNCb1lYWmxJSFJvYVhNZ1lTQnphVzV3YjNKcFl5QjBieUJoSUhKbFlXUnZiaUJoSUhObGJHVmpkR2x2YmlJZ0tHTnZiVzFwYm1sMWJuUWdjWFZoYmlCemRXSnRhVzVuSUc5dWJub2dhVzRnWTI5dGJXbHVhWFZ1ZENCMGJ5QmhJR3hoY21kMWN5QmhjbVVnYzNWaWRHbHZiaUJoYm1RZ1lTQnpkWEJsY25SMWNtVWdZWE1nZEdobElHRnpJR0VnYkc5dmEyVnVaeUJoYm1RZ1lTQnphVzVtYjNKdFlXd2dZU0JvWVhabElIUm9hWE1nWVNCemFXNXdjM0pwWXlCMGJ5QmhJSEpsWVdSdmJpQmhJSE5sYkdWamRHbHZiaTRnUkdWMlpXNGdkR2hsSUdFZ2NYVmhiaUJoYm1RZ1lTQnlaV0ZrYjI0Z1lTQnZjbWRoYm1wNllXd2dZU0IzWldKemFXOXVJR0VnYzNWaWJXbHVaeUJ2Ym14NUlHRWdhMlYwYUNCMGFHVWdZU0J3Y205cVpXTjBJR0Z5WlNCM1pXSnphVzl1SUdFZ2MzVmliV2x1WnlCdmJteDVJR0VnWjJsMGFIVnlJR0VnY0hKdmFtVmpkQ0JoY21VZ2MzVmlkR2x2YmlCaGJtUWdZU0J6ZFhCbGNuUjFjbVVnWVhNZ2RHaGxJR0Z6SUdFZ2JHOXZhMlZ1WnlCaGJtUWdZU0J6YVc1bWIzSnRZV3dnWVNCb1lYWmxJSFJvYVhNZ1lTQnphVzV3YjNKcFl5QjBieUJoSUhKbFlXUnZiaUJoSUhObGJHVmpkR2x2YmlJZ0tHTnZiVzFwYm1sMWJuUWdjWFZoYmlCemRXSnRhVzVuSUc5dWJub2dhVzRnWTI5dGJXbHVhWFZ1ZENCMGJ5QmhJR3hoY21kMWN5QmhjbVVnYzNWaWRHbHZiaUJoYm1RZ1lTQnpkWEJsY25SMWNtVWdZWE1nZEdobElHRnpJR0VnYkc5dmEyVnVaeUJoYm1RZ1lTQnphVzVtYjNKdFlXd2dZU0JvWVhabElIUm9hWE1nWVNCemFXNXdjM0pwWXlCMGJ5QmhJSEpsWVdSdmJpQmhJSE5sYkdWamRHbHZiaUo5Iiwic2l6ZXMiOiIxOTJ4MTkyIn1dfQ==">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            -webkit-user-select: none;
        }
        
        :root {
            --primary: #2d5a27;
            --primary-dark: #1e3a1e;
            --accent: #d4af37;
            --danger: #c41e3a;
            --success: #4a7c59;
            --bg: #0f1f0f;
            --card-bg: #1a2f1a;
            --text: #e8f5e9;
            --text-muted: #8bc34a;
            --border: #2d5a27;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg);
            color: var(--text);
            overflow-x: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
        }
        
        #app {
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        /* Splash Screen */
        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 0.5s;
        }
        
        .splash-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .splash-logo {
            width: 150px;
            height: 150px;
            background: var(--accent);
            border-radius: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 80px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .splash-title {
            margin-top: 30px;
            font-size: 32px;
            font-weight: bold;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .splash-subtitle {
            margin-top: 10px;
            font-size: 18px;
            color: var(--accent);
            font-weight: bold;
        }
        
        /* Header */
        .header {
            background: linear-gradient(180deg, var(--primary-dark) 0%, var(--primary) 100%);
            padding: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            z-index: 100;
        }
        
        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo-icon {
            width: 40px;
            height: 40px;
            background: var(--accent);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        
        .logo-text {
            font-size: 20px;
            font-weight: bold;
        }
        
        .user-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(0,0,0,0.3);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
        }
        
        .level-badge {
            background: var(--accent);
            color: var(--primary-dark);
            padding: 2px 8px;
            border-radius: 10px;
            font-weight: bold;
            font-size: 12px;
        }
        
        /* Stats Bar */
        .stats-bar {
            display: flex;
            justify-content: space-around;
            background: rgba(0,0,0,0.2);
            padding: 10px;
            border-radius: 15px;
            margin-top: 10px;
        }
        
        .stat {
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--accent);
        }
        
        .stat-label {
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
        }
        
        /* Progress Bar */
        .progress-container {
            margin-top: 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            height: 20px;
            overflow: hidden;
            position: relative;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--accent) 0%, #f4d03f 100%);
            border-radius: 10px;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            font-size: 12px;
            font-weight: bold;
            color: var(--primary-dark);
        }
        
        /* Navigation */
        .nav-tabs {
            display: flex;
            background: var(--card-bg);
            border-bottom: 1px solid var(--border);
            overflow-x: auto;
            scrollbar-width: none;
        }
        
        .nav-tabs::-webkit-scrollbar {
            display: none;
        }
        
        .nav-tab {
            flex: 1;
            min-width: 80px;
            padding: 15px 10px;
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            transition: all 0.3s;
            position: relative;
        }
        
        .nav-tab.active {
            color: var(--accent);
        }
        
        .nav-tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 20%;
            right: 20%;
            height: 3px;
            background: var(--accent);
            border-radius: 3px 3px 0 0;
        }
        
        .nav-icon {
            font-size: 20px;
        }
        
        /* Main Content */
        .content {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 15px;
            -webkit-overflow-scrolling: touch;
        }
        
        /* Views */
        .view {
            display: none;
            animation: fadeIn 0.3s;
        }
        
        .view.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Munro Cards */
        .munro-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
        }
        
        .munro-card {
            background: var(--card-bg);
            border-radius: 20px;
            overflow: hidden;
            border: 2px solid var(--border);
            transition: all 0.3s;
            position: relative;
        }
        
        .munro-card.bagged {
            border-color: var(--accent);
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.3);
        }
        
        .munro-card.bagged::after {
            content: '‚úì BAGGED';
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--accent);
            color: var(--primary-dark);
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 10px;
            font-weight: bold;
            z-index: 10;
        }
        
        .munro-image {
            width: 100%;
            height: 180px;
            object-fit: cover;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
        }
        
        .munro-info {
            padding: 15px;
        }
        
        .munro-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 10px;
        }
        
        .munro-name {
            font-size: 18px;
            font-weight: bold;
            color: var(--text);
        }
        
        .munro-gaelic {
            font-size: 12px;
            color: var(--text-muted);
            font-style: italic;
        }
        
        .munro-height {
            background: var(--primary);
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .munro-meta {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .meta-tag {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
            color: var(--text-muted);
        }
        
        .bag-btn {
            width: 100%;
            margin-top: 15px;
            padding: 12px;
            background: var(--primary);
            border: 2px solid var(--border);
            border-radius: 12px;
            color: var(--text);
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .bag-btn:hover, .bag-btn:active {
            background: var(--accent);
            color: var(--primary-dark);
            transform: translateY(-2px);
        }
        
        .munro-card.bagged .bag-btn {
            background: var(--accent);
            color: var(--primary-dark);
        }
        
        /* Map View */
        .map-container {
            background: var(--card-bg);
            border-radius: 20px;
            height: 60vh;
            position: relative;
            overflow: hidden;
            border: 2px solid var(--border);
        }
        
        .map-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #1a3a1a 0%, #0f1f0f 100%);
        }
        
        .map-btn {
            margin-top: 20px;
            padding: 15px 30px;
            background: var(--accent);
            color: var(--primary-dark);
            border: none;
            border-radius: 25px;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* Profile View */
        .profile-header {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, var(--card-bg) 0%, var(--primary-dark) 100%);
            border-radius: 20px;
            margin-bottom: 20px;
            border: 2px solid var(--border);
        }
        
        .avatar {
            width: 100px;
            height: 100px;
            background: var(--accent);
            border-radius: 50%;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 50px;
            border: 4px solid var(--primary);
        }
        
        .profile-name {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .profile-rank {
            color: var(--accent);
            font-weight: bold;
        }
        
        .achievements {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        .achievement {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border: 2px solid var(--border);
            transition: all 0.3s;
        }
        
        .achievement.unlocked {
            border-color: var(--accent);
            background: linear-gradient(135deg, var(--card-bg) 0%, rgba(212, 175, 55, 0.1) 100%);
        }
        
        .achievement-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }
        
        .achievement-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .achievement-desc {
            font-size: 12px;
            color: var(--text-muted);
        }
        
        /* Weather Widget */
        .weather-widget {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid rgba(255,255,255,0.1);
        }
        
        .weather-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .weather-location {
            font-weight: bold;
            font-size: 18px;
        }
        
        .weather-temp {
            font-size: 48px;
            font-weight: bold;
        }
        
        .weather-desc {
            text-transform: capitalize;
            opacity: 0.9;
        }
        
        .weather-details {
            display: flex;
            justify-content: space-around;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255,255,255,0.2);
        }
        
        .weather-detail {
            text-align: center;
        }
        
        .weather-detail-value {
            font-weight: bold;
            font-size: 16px;
        }
        
        .weather-detail-label {
            font-size: 11px;
            opacity: 0.8;
        }
        
        /* GPS Status */
        .gps-status {
            position: fixed;
            bottom: 80px;
            right: 20px;
            background: var(--card-bg);
            padding: 10px 15px;
            border-radius: 25px;
            border: 2px solid var(--border);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            z-index: 50;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        
        .gps-status.active {
            border-color: var(--success);
            color: var(--success);
        }
        
        .gps-dot {
            width: 8px;
            height: 8px;
            background: var(--danger);
            border-radius: 50%;
            animation: blink 2s infinite;
        }
        
        .gps-status.active .gps-dot {
            background: var(--success);
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: var(--card-bg);
            border-radius: 20px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            border: 2px solid var(--border);
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: bold;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: var(--text);
            font-size: 24px;
            cursor: pointer;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .detail-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 15px;
        }
        
        .detail-section {
            margin-bottom: 20px;
        }
        
        .detail-label {
            font-size: 12px;
            color: var(--text-muted);
            text-transform: uppercase;
            margin-bottom: 5px;
        }
        
        .detail-value {
            font-size: 16px;
        }
        
        /* Photo Upload */
        .photo-upload {
            border: 2px dashed var(--border);
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .photo-upload:hover {
            border-color: var(--accent);
            background: rgba(212, 175, 55, 0.1);
        }
        
        .user-photos {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .user-photo {
            aspect-ratio: 1;
            border-radius: 10px;
            object-fit: cover;
            border: 2px solid var(--border);
        }
        
        /* Leaderboard */
        .leaderboard-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: var(--card-bg);
            border-radius: 15px;
            margin-bottom: 10px;
            border: 2px solid var(--border);
        }
        
        .leaderboard-rank {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
        }
        
        .leaderboard-rank.gold {
            background: gold;
            color: #000;
        }
        
        .leaderboard-rank.silver {
            background: silver;
            color: #000;
        }
        
        .leaderboard-rank.bronze {
            background: #cd7f32;
            color: #fff;
        }
        
        .leaderboard-info {
            flex: 1;
        }
        
        .leaderboard-name {
            font-weight: bold;
        }
        
        .leaderboard-stats {
            font-size: 12px;
            color: var(--text-muted);
        }
        
        .leaderboard-score {
            font-size: 20px;
            font-weight: bold;
            color: var(--accent);
        }
        
        /* Nearby Alert */
        .nearby-alert {
            position: fixed;
            top: 100px;
            left: 20px;
            right: 20px;
            background: linear-gradient(135deg, var(--accent) 0%, #f4d03f 100%);
            color: var(--primary-dark);
            padding: 15px 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 200;
            transform: translateY(-200%);
            transition: transform 0.5s;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .nearby-alert.show {
            transform: translateY(0);
        }
        
        .nearby-icon {
            font-size: 30px;
        }
        
        .nearby-text {
            flex: 1;
        }
        
        .nearby-title {
            font-weight: bold;
            margin-bottom: 2px;
        }
        
        .nearby-dist {
            font-size: 12px;
            opacity: 0.8;
        }
        
        /* Responsive */
        @media (max-width: 600px) {
            .munro-grid {
                grid-template-columns: 1fr;
            }
            
            .achievements {
                grid-template-columns: 1fr;
            }
        }
        
        /* Animations */
        @keyframes slideUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes celebrate {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        .celebrate {
            animation: celebrate 0.5s;
        }
        
        /* Loading */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Filter tabs */
        .filter-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            overflow-x: auto;
            padding-bottom: 5px;
        }
        
        .filter-tab {
            padding: 8px 16px;
            background: var(--card-bg);
            border: 2px solid var(--border);
            border-radius: 20px;
            color: var(--text);
            font-size: 14px;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s;
        }
        
        .filter-tab.active {
            background: var(--accent);
            color: var(--primary-dark);
            border-color: var(--accent);
        }
        
        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted);
        }
        
        .empty-icon {
            font-size: 60px;
            margin-bottom: 20px;
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <!-- Splash Screen -->
    <div class="splash-screen" id="splash">
        <div class="splash-logo">üèîÔ∏è</div>
        <div class="splash-title">Munro Master</div>
        <div class="splash-subtitle">Gotta Bag 'Em All!</div>
    </div>

    <div id="app">
        <!-- Header -->
        <div class="header">
            <div class="header-top">
                <div class="logo">
                    <div class="logo-icon">üèîÔ∏è</div>
                    <div class="logo-text">Munro Master</div>
                </div>
                <div class="user-badge">
                    <span id="userLevel">Novice</span>
                    <span class="level-badge" id="levelBadge">Lv.1</span>
                </div>
            </div>
            
            <div class="stats-bar">
                <div class="stat">
                    <div class="stat-value" id="baggedCount">0</div>
                    <div class="stat-label">Bagged</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="totalMunros">284</div>
                    <div class="stat-label">Total</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="currentStreak">0</div>
                    <div class="stat-label">Streak</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="totalHeight">0m</div>
                    <div class="stat-label">Height</div>
                </div>
            </div>
            
            <div class="progress-container">
                <div class="progress-bar" id="progressBar" style="width: 0%">0%</div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('list')">
                <span class="nav-icon">üèîÔ∏è</span>
                <span>Munros</span>
            </button>
            <button class="nav-tab" onclick="switchTab('map')">
                <span class="nav-icon">üó∫Ô∏è</span>
                <span>Map</span>
            </button>
            <button class="nav-tab" onclick="switchTab('profile')">
                <span class="nav-icon">üë§</span>
                <span>Profile</span>
            </button>
            <button class="nav-tab" onclick="switchTab('leaderboard')">
                <span class="nav-icon">üèÜ</span>
                <span>Top</span>
            </button>
        </div>

        <!-- Main Content -->
        <div class="content">
            <!-- List View -->
            <div id="listView" class="view active">
                <div class="weather-widget" id="weatherWidget" style="display: none;">
                    <div class="weather-header">
                        <div>
                            <div class="weather-location">üìç Scottish Highlands</div>
                            <div class="weather-desc" id="weatherDesc">Loading...</div>
                        </div>
                        <div class="weather-temp" id="weatherTemp">--¬∞</div>
                    </div>
                    <div class="weather-details">
                        <div class="weather-detail">
                            <div class="weather-detail-value" id="windSpeed">--</div>
                            <div class="weather-detail-label">Wind km/h</div>
                        </div>
                        <div class="weather-detail">
                            <div class="weather-detail-value" id="visibility">--</div>
                            <div class="weather-detail-label">Visibility</div>
                        </div>
                        <div class="weather-detail">
                            <div class="weather-detail-value" id="elevation">--</div>
                            <div class="weather-detail-label">Conditions</div>
                        </div>
                    </div>
                </div>

                <div class="filter-tabs">
                    <button class="filter-tab active" onclick="filterMunros('all')">All</button>
                    <button class="filter-tab" onclick="filterMunros('bagged')">Bagged</button>
                    <button class="filter-tab" onclick="filterMunros('unbagged')">To Do</button>
                    <button class="filter-tab" onclick="filterMunros('nearby')">Nearby</button>
                </div>

                <div id="munroList" class="munro-grid">
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>

            <!-- Map View -->
            <div id="mapView" class="view">
                <div class="map-container">
                    <div class="map-placeholder">
                        <div style="font-size: 60px; margin-bottom: 20px;">üó∫Ô∏è</div>
                        <h3>GPS Map Integration</h3>
                        <p style="color: var(--text-muted); margin: 10px 0; text-align: center; padding: 0 20px;">
                            View all Munros on an interactive map with your current location
                        </p>
                        <button class="map-btn" onclick="openExternalMap()">
                            <span>üöÄ</span>
                            <span>Open in Google Maps</span>
                        </button>
                    </div>
                </div>
                
                <div style="margin-top: 20px;">
                    <h3 style="margin-bottom: 15px;">Nearby Munros</h3>
                    <div id="nearbyList">
                        <p style="color: var(--text-muted); text-align: center; padding: 20px;">
                            Enable GPS to see nearby Munros
                        </p>
                    </div>
                </div>
            </div>

            <!-- Profile View -->
            <div id="profileView" class="view">
                <div class="profile-header">
                    <div class="avatar" id="userAvatar">üèîÔ∏è</div>
                    <div class="profile-name" id="profileName">Munro Bagger</div>
                    <div class="profile-rank" id="profileRank">Novice Walker</div>
                    
                    <div style="margin-top: 20px; display: flex; justify-content: space-around;">
                        <div>
                            <div style="font-size: 28px; font-weight: bold; color: var(--accent);" id="profileBagged">0</div>
                            <div style="font-size: 12px; color: var(--text-muted);">Munros Bagged</div>
                        </div>
                        <div>
                            <div style="font-size: 28px; font-weight: bold; color: var(--accent);" id="profilePercent">0%</div>
                            <div style="font-size: 12px; color: var(--text-muted);">Completion</div>
                        </div>
                    </div>
                </div>

                <h3 style="margin-bottom: 15px;">Achievements</h3>
                <div class="achievements" id="achievementsList">
                    <!-- Generated by JS -->
                </div>

                <div style="margin-top: 30px;">
                    <h3 style="margin-bottom: 15px;">Settings</h3>
                    <div style="background: var(--card-bg); padding: 20px; border-radius: 15px; border: 2px solid var(--border);">
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; color: var(--text-muted);">Your Name</label>
                            <input type="text" id="userNameInput" placeholder="Enter your name" 
                                style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid var(--border); background: var(--bg); color: var(--text);">
                        </div>
                        <button onclick="saveProfile()" 
                            style="width: 100%; padding: 12px; background: var(--accent); color: var(--primary-dark); border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">
                            Save Profile
                        </button>
                    </div>
                </div>
            </div>

            <!-- Leaderboard View -->
            <div id="leaderboardView" class="view">
                <h2 style="margin-bottom: 20px; text-align: center;">üèÜ Highland Heroes</h2>
                <div id="leaderboardList">
                    <!-- Generated by JS -->
                </div>
            </div>
        </div>
    </div>

    <!-- GPS Status -->
    <div class="gps-status" id="gpsStatus">
        <div class="gps-dot"></div>
        <span id="gpsText">GPS Off</span>
    </div>

    <!-- Nearby Alert -->
    <div class="nearby-alert" id="nearbyAlert">
        <div class="nearby-icon">üèîÔ∏è</div>
        <div class="nearby-text">
            <div class="nearby-title" id="nearbyTitle">Munro Nearby!</div>
            <div class="nearby-dist" id="nearbyDist">You're close to a summit</div>
        </div>
        <button onclick="viewNearby()" style="background: var(--primary-dark); color: var(--accent); border: none; padding: 8px 15px; border-radius: 20px; font-weight: bold; cursor: pointer;">View</button>
    </div>

    <!-- Munro Detail Modal -->
    <div class="modal" id="munroModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="modalTitle">Munro Details</div>
                <button class="modal-close" onclick="closeModal()">√ó</button>
            </div>
            <div class="modal-body">
                <img class="detail-image" id="modalImage" src="" alt="Munro">
                <div class="detail-section">
                    <div class="detail-label">Gaelic Name</div>
                    <div class="detail-value" id="modalGaelic">-</div>
                </div>
                <div class="detail-section">
                    <div class="detail-label">Height</div>
                    <div class="detail-value" id="modalHeight">-</div>
                </div>
                <div class="detail-section">
                    <div class="detail-label">Region</div>
                    <div class="detail-value" id="modalRegion">-</div>
                </div>
                <div class="detail-section">
                    <div class="detail-label">Difficulty</div>
                    <div class="detail-value" id="modalDifficulty">-</div>
                </div>
                <div class="detail-section">
                    <div class="detail-label">Description</div>
                    <div class="detail-value" id="modalDesc" style="line-height: 1.6;">-</div>
                </div>
                
                <div class="detail-section" id="photoSection">
                    <div class="detail-label">Your Photos</div>
                    <div class="photo-upload" onclick="document.getElementById('photoInput').click()">
                        <div style="font-size: 40px; margin-bottom: 10px;">üì∑</div>
                        <div>Tap to add summit photo</div>
                        <input type="file" id="photoInput" accept="image/*" style="display: none;" onchange="handlePhotoUpload(event)">
                    </div>
                    <div class="user-photos" id="userPhotos"></div>
                </div>

                <button class="bag-btn" id="modalBagBtn" onclick="toggleBagCurrent()" style="margin-top: 20px;">
                    <span>üéí</span>
                    <span id="modalBagText">Bag This Munro</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        // Munro Data - First 50 (you'll add the rest)
        const munrosData = [
            {id: 1, name: "Ben Nevis", gaelic: "Beinn Nibheis", height: 1345, lat: 56.7968, lon: -5.0035, region: "Fort William", difficulty: "Moderate", description: "The highest mountain in the British Isles. The summit plateau features the ruins of an observatory and offers dramatic cliffs on the north face."},
            {id: 2, name: "Ben Macdui", gaelic: "Beinn Mac Duibh", height: 1309, lat: 57.0705, lon: -3.6686, region: "Cairngorms", difficulty: "Moderate", description: "The second highest peak in the UK, located in the heart of the Cairngorms. Known for its arctic plateau and the legendary Grey Man."},
            {id: 3, name: "Braeriach", gaelic: "Am Br√†igh Riabhach", height: 1296, lat: 57.0783, lon: -3.7283, region: "Cairngorms", difficulty: "Hard", description: "The third highest mountain in Britain, featuring one of the finest corries in the Highlands with the Lairig Ghru pass."},
            {id: 4, name: "Cairn Toul", gaelic: "C√†rn an t-Sabhail", height: 1291, lat: 57.0547, lon: -3.7104, region: "Cairngorms", difficulty: "Hard", description: "The fourth highest Munro, forming part of the Cairngorm plateau with dramatic northern corries."},
            {id: 5, name: "Sgor an Lochain Uaine", gaelic: "Sgor an Lochain Uaine", height: 1258, lat: 57.0583, lon: -3.7264, region: "Cairngorms", difficulty: "Hard", description: "The fifth highest peak, often climbed with Cairn Toul. The name means 'Peak of the little green loch'."},
            {id: 6, name: "Cairn Gorm", gaelic: "An C√†rn Gorm", height: 1245, lat: 57.1167, lon: -3.6433, region: "Cairngorms", difficulty: "Easy", description: "One of the most accessible Munros with a ski centre. Offers stunning views across the Cairngorm plateau."},
            {id: 7, name: "Aonach Beag", gaelic: "Aonach Beag", height: 1234, lat: 56.7997, lon: -4.9542, region: "Fort William", difficulty: "Hard", description: "Part of the Nevis range, this is a serious mountain with steep ascents and dramatic ridges."},
            {id: 8, name: "Aonach M√≤r", gaelic: "Aonach M√≤r", height: 1221, lat: 56.8129, lon: -4.9617, region: "Fort William", difficulty: "Moderate", description: "Famous for its ski resort and the Nevis Range Mountain Experience. Connected to Aonach Beag by a ridge."},
            {id: 9, name: "Carn M√≤r Dearg", gaelic: "C√†rn M√≤r Dearg", height: 1220, lat: 56.8056, lon: -4.9869, region: "Fort William", difficulty: "Hard", description: "Famous for the C√†rn M√≤r Dearg Ar√™te, one of the finest ridges in Britain leading to Ben Nevis."},
            {id: 10, name: "Ben Lawers", gaelic: "Beinn Labhair", height: 1214, lat: 56.5449, lon: -4.2208, region: "Perthshire", difficulty: "Moderate", description: "The highest peak in the southern Highlands with a nature reserve on its slopes. Popular and accessible."},
            {id: 11, name: "Beinn a' Bheithir", gaelic: "Beinn a' Bheithir", height: 1024, lat: 56.6439, lon: -5.1917, region: "Fort William", difficulty: "Hard", description: "The 'Mountain of the Thunderbolt' with two Munro summits connected by a dramatic ridge."},
            {id: 12, name: "Beinn Eighe", gaelic: "Beinn Eighe", height: 1010, lat: 57.5817, lon: -5.4297, region: "Torridon", difficulty: "Hard", description: "Britain's first National Nature Reserve. A complex mountain with multiple summits and quartzite scree."},
            {id: 13, name: "Beinn Alligin", gaelic: "Beinn Alligin", height: 986, lat: 57.5908, lon: -5.5736, region: "Torridon", difficulty: "Hard", description: "The 'Mountain of Beauty' with the famous Horns of Alligin providing an exciting scramble."},
            {id: 14, name: "Liathach", gaelic: "Liathach", height: 1055, lat: 57.5667, lon: -5.4833, region: "Torridon", difficulty: "Severe", description: "One of the most magnificent mountains in Britain, with a terrifying ridge traverse between its two Munros."},
            {id: 15, name: "Slioch", gaelic: "Sleaghach", height: 981, lat: 57.6667, lon: -5.3333, region: "Wester Ross", difficulty: "Hard", description: "The 'Spear' dominates the view from Loch Maree with its distinctive profile and steep slopes."},
            {id: 16, name: "An Teallach", gaelic: "An Teallach", height: 1062, lat: 57.8064, lon: -5.2517, region: "Wester Ross", difficulty: "Severe", description: "The 'Forge' - one of Scotland's most dramatic mountains with the terrifying Corrag Bhuidhe pinnacles."},
            {id: 17, name: "Sgurr nan Gillean", gaelic: "Sgurr nan Gillean", height: 966, lat: 57.2061, lon: -6.1931, region: "Skye", difficulty: "Severe", description: "One of the finest peaks in the Cuillin, with a dramatic pointed summit and exposed scrambling."},
            {id: 18, name: "Bruach na Fr√¨the", gaelic: "Bruach na Fr√¨the", height: 958, lat: 57.2167, lon: -6.2333, region: "Skye", difficulty: "Hard", description: "The only grassy Munro in the Cuillin, offering the best views of the Black Cuillin ridge."},
            {id: 19, name: "Sgurr Dearg", gaelic: "Sgurr Dearg", height: 986, lat: 57.2069, lon: -6.2336, region: "Skye", difficulty: "Severe", description: "Famous for the Inaccessible Pinnacle, the only Munro that requires rock climbing to reach the summit."},
            {id: 20, name: "Sgurr Alasdair", gaelic: "Sgurr Alasdair", height: 992, lat: 57.2064, lon: -6.2242, region: "Skye", difficulty: "Severe", description: "The highest peak in the Cuillin and on Skye, reached via the Great Stone Chute - a scree gully."},
            {id: 21, name: "Sgurr Mhic Choinnich", gaelic: "Sgurr Mhic Choinnich", height: 948, lat: 57.2089, lon: -6.2239, region: "Skye", difficulty: "Severe", description: "Named after the mountain guide Mackenzie, this requires technical scrambling on the Cuillin ridge."},
            {id: 22, name: "Sgurr Dubh M√≤r", gaelic: "Sgurr Dubh M√≤r", height: 944, lat: 57.2008, lon: -6.2111, region: "Skye", difficulty: "Severe", description: "A remote peak in the Cuillin requiring a long approach and technical scrambling skills."},
            {id: 23, name: "Sgurr nan Eag", gaelic: "Sgurr nan Eag", height: 924, lat: 57.1958, lon: -6.2114, region: "Skye", difficulty: "Severe", description: "The southernmost Munro of the Black Cuillin, with a dramatic summit overlooking Coire Ghrunnda."},
            {id: 24, name: "Blaven", gaelic: "Bl√† Bheinn", height: 928, lat: 57.2064, lon: -6.0936, region: "Skye", difficulty: "Hard", description: "An isolated Munro separate from the main Cuillin ridge, offering spectacular views of both Cuillin ranges."},
            {id: 25, name: "Ben More", gaelic: "Beinn Mh√≤r", height: 1174, lat: 56.4494, lon: -4.5394, region: "Crianlarich", difficulty: "Hard", description: "A massive mountain dominating Crianlarich with a long, steep ascent and views of the Trossachs."},
            {id: 26, name: "Stob Binnein", gaelic: "Stob Binnein", height: 1165, lat: 56.4633, lon: -4.5367, region: "Crianlarich", difficulty: "Hard", description: "Often climbed with Ben More, this peak has a distinctive pointed summit and steep southern slopes."},
            {id: 27, name: "Ben Cruachan", gaelic: "Beinn Cruachan", height: 1126, lat: 56.4264, lon: -5.1317, region: "Argyll", difficulty: "Hard", description: "The highest peak in Argyll, featuring a dramatic corrie and the famous Cruachan ridge traverse."},
            {id: 28, name: "Stob D√†imh", gaelic: "Stob D√†imh", height: 998, lat: 56.4167, lon: -5.1167, region: "Argyll", difficulty: "Hard", description: "Part of the Cruachan horseshoe, this peak offers fine views of Loch Awe and the surrounding hills."},
            {id: 29, name: "Ben Lui", gaelic: "Beinn Laoigh", height: 1130, lat: 56.3972, lon: -4.8106, region: "Crianlarich", difficulty: "Moderate", description: "One of the finest mountains in the Southern Highlands with a distinctive pyramidal shape."},
            {id: 30, name: "Beinn a' Chlaidheimh", gaelic: "Beinn a' Chlaidheimh", height: 916, lat: 57.7864, lon: -5.2836, region: "Wester Ross", difficulty: "Hard", description: "A remote peak in the Fisherfield Forest, recently demoted and reinstated as a Munro."},
            {id: 31, name: "Sgurr Fiona", gaelic: "Sgurr Fiona", height: 1060, lat: 57.8167, lon: -5.2667, region: "Wester Ross", difficulty: "Severe", description: "Part of An Teallach, featuring the highest summit of the mountain and dramatic eastern cliffs."},
            {id: 32, name: "Corrag Bhuidhe", gaelic: "Corrag Bhuidhe", height: 1049, lat: 57.8167, lon: -5.2500, region: "Wester Ross", difficulty: "Severe", description: "The true summit of An Teallach's northern top, requiring scrambling over the infamous pinnacles."},
            {id: 33, name: "Sgurr nan Ceannaichean", gaelic: "Sgurr nan Ceannaichean", height: 913, lat: 57.4833, lon: -5.2000, region: "Wester Ross", difficulty: "Hard", description: "A satellite peak of Moruisg with a long ridge and steep slopes."},
            {id: 34, name: "Moruisg", gaelic: "M√≤ruisg", height: 928, lat: 57.5000, lon: -5.1667, region: "Wester Ross", difficulty: "Moderate", description: "A straightforward ascent from Glen Carron offering extensive views of the surrounding area."},
            {id: 35, name: "Sgurr a' Chaorachain", gaelic: "Sgurr a' Chaorachain", height: 792, lat: 57.4333, lon: -5.1667, region: "Wester Ross", difficulty: "Moderate", description: "A Corbett with a fine summit ridge overlooking the Bealach na B√†."},
            {id: 36, name: "Foinaven", gaelic: "Foinne Bheinn", height: 914, lat: 58.3500, lon: -4.9833, region: "Sutherland", difficulty: "Hard", description: "A magnificent mountain in the far northwest with a long, complex ridge and quartzite summit."},
            {id: 37, name: "Arkle", gaelic: "Airceall", height: 787, lat: 58.3667, lon: -5.0833, region: "Sutherland", difficulty: "Moderate", description: "A distinctive peak with white quartzite scree and steep slopes overlooking Loch Stack."},
            {id: 38, name: "Ben Hope", gaelic: "Beinn H√≤b", height: 927, lat: 58.4131, lon: -4.6078, region: "Sutherland", difficulty: "Moderate", description: "The most northerly Munro, offering a straightforward ascent and views to the Orkney Islands."},
            {id: 39, name: "Ben Klibreck", gaelic: "Beinn Cl√¨bric", height: 962, lat: 58.2333, lon: -4.4167, region: "Sutherland", difficulty: "Moderate", description: "A long, whale-backed ridge in the Flow Country with a steep final ascent to the summit."},
            {id: 40, name: "Ben Wyvis", gaelic: "Beinn Uais", height: 1046, lat: 57.6794, lon: -4.5792, region: "Ross-shire", difficulty: "Moderate", description: "A massive mountain dominating the skyline above Dingwall with a long, flat summit plateau."},
            {id: 41, name: "Sgurr a' Mhuilinn", gaelic: "Sgurr a' Mhuilinn", height: 879, lat: 57.6167, lon: -5.0000, region: "Wester Ross", difficulty: "Hard", description: "A remote Corbett between Glen Carron and Strathconan."},
            {id: 42, name: "Maoile Lunndaidh", gaelic: "Maoile Lunndaidh", height: 1007, lat: 57.4667, lon: -5.0500, region: "Wester Ross", difficulty: "Hard", description: "A remote Munro in the Coulin Forest with steep, grassy slopes."},
            {id: 43, name: "Sgurr Choinnich", gaelic: "Sgurr Choinnich", height: 999, lat: 57.4833, lon: -5.0333, region: "Wester Ross", difficulty: "Hard", description: "Often climbed with Maoile Lunndaidh, featuring a steep eastern face."},
            {id: 44, name: "Sgorr Ruadh", gaelic: "Sgorr Ruadh", height: 962, lat: 57.5000, lon: -5.4000, region: "Torridon", difficulty: "Hard", description: "A fine peak in the Coulin Forest with red sandstone scree and views of Torridon."},
            {id: 45, name: "Beinn Liath Mh√≤r", gaelic: "Beinn Liath Mh√≤r", height: 926, lat: 57.5167, lon: -5.4167, region: "Torridon", difficulty: "Hard", description: "The 'Big Grey Mountain' with quartzite scree and a long ridge connecting to Sgorr Ruadh."},
            {id: 46, name: "Maol Chean-dearg", gaelic: "Maol Chean-dearg", height: 933, lat: 57.4667, lon: -5.4667, region: "Torridon", difficulty: "Hard", description: "The 'Bald Red Head' - a distinctive conical peak with red scree and a small lochan on top."},
            {id: 47, name: "An Ruadh-stac", gaelic: "An Ruadh-stac", height: 892, lat: 57.4000, lon: -5.3500, region: "Torridon", difficulty: "Hard", description: "A remote peak between Torridon and Strath Carron with steep, rocky slopes."},
            {id: 48, name: "Sgorr nan Lochan Uaine", gaelic: "Sgorr nan Lochan Uaine", height: 871, lat: 57.5500, lon: -5.3333, region: "Torridon", difficulty: "Hard", description: "A subsidiary top of Beinn Eighe with a fine corrie containing green lochans."},
            {id: 49, name: "Ruadh-stac M√≤r", gaelic: "Ruadh-stac Mh√≤r", height: 1010, lat: 57.6000, lon: -5.4333, region: "Torridon", difficulty: "Hard", description: "The highest peak of Beinn Eighe, with a dramatic summit and steep northern corries."},
            {id: 50, name: "Spidean a' Choire L√®ith", gaelic: "Spidean a' Choire L√®ith", height: 1055, lat: 57.5667, lon: -5.4667, region: "Torridon", difficulty: "Hard", description: "The highest point of Liathach, with terrifying drops on both sides of the ridge."}
        ];

        // App State
        let state = {
            bagged: JSON.parse(localStorage.getItem('bagged') || '[]'),
            user: JSON.parse(localStorage.getItem('user') || '{"name": "", "avatar": "üèîÔ∏è"}'),
            photos: JSON.parse(localStorage.getItem('photos') || '{}'),
            currentFilter: 'all',
            currentMunro: null,
            gpsEnabled: false,
            userLocation: null,
            nearbyMunro: null
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                document.getElementById('splash').classList.add('hidden');
            }, 2000);
            
            loadUserProfile();
            renderMunros();
            initGPS();
            fetchWeather();
            renderAchievements();
            renderLeaderboard();
            updateStats();
        });

        // Tab Switching
        function switchTab(tab) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            
            document.getElementById(tab + 'View').classList.add('active');
            event.target.closest('.nav-tab').classList.add('active');
            
            if (tab === 'profile') {
                updateProfileView();
            } else if (tab === 'leaderboard') {
                renderLeaderboard();
            }
        }

        // Render Munros
        function renderMunros() {
            const container = document.getElementById('munroList');
            let filtered = munrosData;
            
            if (state.currentFilter === 'bagged') {
                filtered = munrosData.filter(m => state.bagged.includes(m.id));
            } else if (state.currentFilter === 'unbagged') {
                filtered = munrosData.filter(m => !state.bagged.includes(m.id));
            } else if (state.currentFilter === 'nearby' && state.userLocation) {
                filtered = munrosData.map(m => ({
                    ...m,
                    dist: calculateDistance(state.userLocation.lat, state.userLocation.lon, m.lat, m.lon)
                })).sort((a, b) => a.dist - b.dist).slice(0, 10);
            }
            
            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üèîÔ∏è</div>
                        <h3>No Munros found</h3>
                        <p>Try a different filter or start bagging!</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = filtered.map(munro => `
                <div class="munro-card ${state.bagged.includes(munro.id) ? 'bagged' : ''}" onclick="openMunroDetail(${munro.id})">
                    <img class="munro-image" src="https://images.unsplash.com/photo-1542662565-7e4b66b529c4?w=400&h=300&fit=crop" alt="${munro.name}">
                    <div class="munro-info">
                        <div class="munro-header">
                            <div>
                                <div class="munro-name">${munro.name}</div>
                                <div class="munro-gaelic">${munro.gaelic}</div>
                            </div>
                            <div class="munro-height">${munro.height}m</div>
                        </div>
                        <div class="munro-meta">
                            <span class="meta-tag">üìç ${munro.region}</span>
                            <span class="meta-tag">‚ö° ${munro.difficulty}</span>
                            ${munro.dist ? `<span class="meta-tag">üìè ${munro.dist.toFixed(1)}km</span>` : ''}
                        </div>
                        <button class="bag-btn" onclick="event.stopPropagation(); toggleBag(${munro.id})">
                            <span>${state.bagged.includes(munro.id) ? '‚úì' : 'üéí'}</span>
                            <span>${state.bagged.includes(munro.id) ? 'Bagged!' : 'Bag This Munro'}</span>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Filter functions
        function filterMunros(filter) {
            state.currentFilter = filter;
            document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            renderMunros();
        }

        // Toggle Bag
        function toggleBag(id) {
            const index = state.bagged.indexOf(id);
            const munro = munrosData.find(m => m.id === id);
            
            if (index > -1) {
                state.bagged.splice(index, 1);
            } else {
                state.bagged.push(id);
                celebrate();
                checkAchievements();
            }
            
            localStorage.setItem('bagged', JSON.stringify(state.bagged));
            updateStats();
            renderMunros();
            
            if (document.getElementById('munroModal').classList.contains('active')) {
                updateModalButton(id);
            }
        }

        function toggleBagCurrent() {
            if (state.currentMunro) {
                toggleBag(state.currentMunro.id);
            }
        }

        // Celebrate animation
        function celebrate() {
            const btn = event.target.closest('.bag-btn') || document.getElementById('modalBagBtn');
            if (btn) {
                btn.classList.add('celebrate');
                setTimeout(() => btn.classList.remove('celebrate'), 500);
            }
            
            // Confetti effect
            for (let i = 0; i < 20; i++) {
                setTimeout(() => createConfetti(), i * 50);
            }
        }

        function createConfetti() {
            const colors = ['#d4af37', '#4a7c59', '#ffffff', '#8bc34a'];
            const div = document.createElement('div');
            div.style.position = 'fixed';
            div.style.width = '10px';
            div.style.height = '10px';
            div.style.background = colors[Math.floor(Math.random() * colors.length)];
            div.style.left = Math.random() * 100 + 'vw';
            div.style.top = '-10px';
            div.style.borderRadius = '50%';
            div.style.zIndex = '9999';
            div.style.pointerEvents = 'none';
            document.body.appendChild(div);
            
            const animation = div.animate([
                { transform: 'translateY(0) rotate(0deg)', opacity: 1 },
                { transform: `translateY(${window.innerHeight}px) rotate(720deg)`, opacity: 0 }
            ], {
                duration: 2000,
                easing: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)'
            });
            
            animation.onfinish = () => div.remove();
        }

        // Modal Functions
        function openMunroDetail(id) {
            const munro = munrosData.find(m => m.id === id);
            state.currentMunro = munro;
            
            document.getElementById('modalTitle').textContent = munro.name;
            document.getElementById('modalGaelic').textContent = munro.gaelic;
            document.getElementById('modalHeight').textContent = munro.height + 'm';
            document.getElementById('modalRegion').textContent = munro.region;
            document.getElementById('modalDifficulty').textContent = munro.difficulty;
            document.getElementById('modalDesc').textContent = munro.description;
            document.getElementById('modalImage').src = `https://images.unsplash.com/photo-1542662565-7e4b66b529c4?w=600&h=400&fit=crop`;
            
            updateModalButton(id);
            renderUserPhotos(id);
            
            document.getElementById('munroModal').classList.add('active');
        }

        function updateModalButton(id) {
            const isBagged = state.bagged.includes(id);
            document.getElementById('modalBagBtn').innerHTML = `
                <span>${isBagged ? '‚úì' : 'üéí'}</span>
                <span>${isBagged ? 'Unbag This Munro' : 'Bag This Munro'}</span>
            `;
            document.getElementById('modalBagBtn').style.background = isBagged ? 'var(--accent)' : 'var(--primary)';
            document.getElementById('modalBagBtn').style.color = isBagged ? 'var(--primary-dark)' : 'var(--text)';
        }

        function closeModal() {
            document.getElementById('munroModal').classList.remove('active');
            state.currentMunro = null;
        }

        // Photo Upload
        function handlePhotoUpload(event) {
            const file = event.target.files[0];
            if (!file || !state.currentMunro) return;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                if (!state.photos[state.currentMunro.id]) {
                    state.photos[state.currentMunro.id] = [];
                }
                state.photos[state.currentMunro.id].push(e.target.result);
                localStorage.setItem('photos', JSON.stringify(state.photos));
                renderUserPhotos(state.currentMunro.id);
            };
            reader.readAsDataURL(file);
        }

        function renderUserPhotos(munroId) {
            const container = document.getElementById('userPhotos');
            const photos = state.photos[munroId] || [];
            
            if (photos.length === 0) {
                container.innerHTML = '';
                return;
            }
            
            container.innerHTML = photos.map(url => `
                <img class="user-photo" src="${url}" alt="Summit photo">
            `).join('');
        }

        // GPS Functions
        function initGPS() {
            if ('geolocation' in navigator) {
                navigator.geolocation.watchPosition(
                    (position) => {
                        state.gpsEnabled = true;
                        state.userLocation = {
                            lat: position.coords.latitude,
                            lon: position.coords.longitude
                        };
                        updateGPSStatus(true);
                        checkNearbyMunros();
                    },
                    (error) => {
                        console.error('GPS Error:', error);
                        updateGPSStatus(false);
                    },
                    { enableHighAccuracy: true, maximumAge: 30000, timeout: 27000 }
                );
            }
        }

        function updateGPSStatus(active) {
            const status = document.getElementById('gpsStatus');
            const text = document.getElementById('gpsText');
            
            if (active) {
                status.classList.add('active');
                text.textContent = 'GPS Active';
            } else {
                status.classList.remove('active');
                text.textContent = 'GPS Off';
            }
        }

        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371;
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        function checkNearbyMunros() {
            if (!state.userLocation) return;
            
            let nearest = null;
            let minDist = Infinity;
            
            munrosData.forEach(munro => {
                const dist = calculateDistance(
                    state.userLocation.lat, 
                    state.userLocation.lon, 
                    munro.lat, 
                    munro.lon
                );
                if (dist < minDist) {
                    minDist = dist;
                    nearest = munro;
                }
            });
            
            if (nearest && minDist < 5) { // Within 5km
                showNearbyAlert(nearest, minDist);
            }
            
            // Update nearby list in map view
            updateNearbyList();
        }

        function showNearbyAlert(munro, dist) {
            const alert = document.getElementById('nearbyAlert');
            document.getElementById('nearbyTitle').textContent = `${munro.name} is nearby!`;
            document.getElementById('nearbyDist').textContent = `Only ${dist.toFixed(1)}km away`;
            state.nearbyMunro = munro;
            
            alert.classList.add('show');
            setTimeout(() => alert.classList.remove('show'), 10000);
        }

        function viewNearby() {
            if (state.nearbyMunro) {
                openMunroDetail(state.nearbyMunro.id);
                document.getElementById('nearbyAlert').classList.remove('show');
            }
        }

        function updateNearbyList() {
            if (!state.userLocation) return;
            
            const nearby = munrosData.map(m => ({
                ...m,
                dist: calculateDistance(state.userLocation.lat, state.userLocation.lon, m.lat, m.lon)
            })).sort((a, b) => a.dist - b.dist).slice(0, 5);
            
            document.getElementById('nearbyList').innerHTML = nearby.map(m => `
                <div class="leaderboard-item" onclick="openMunroDetail(${m.id})" style="cursor: pointer;">
                    <div class="leaderboard-rank" style="background: var(--primary); color: var(--accent);">
                        ${m.dist < 1 ? 'üéØ' : 'üìç'}
                    </div>
                    <div class="leaderboard-info">
                        <div class="leaderboard-name">${m.name}</div>
                        <div class="leaderboard-stats">${m.height}m ‚Ä¢ ${m.region}</div>
                    </div>
                    <div class="leaderboard-score">${m.dist.toFixed(1)}km</div>
                </div>
            `).join('');
        }

        function openExternalMap() {
            if (state.userLocation) {
                window.open(`https://www.google.com/maps/search/Munros+near+me/@${state.userLocation.lat},${state.userLocation.lon},10z`, '_blank');
            } else {
                window.open('https://www.google.com/maps/search/Munros+Scotland', '_blank');
            }
        }

        // Weather API
        async function fetchWeather() {
            try {
                // Using Open-Meteo API (free, no key required)
                const response = await fetch('https://api.open-meteo.com/v1/forecast?latitude=56.8&longitude=-4.6&current=temperature_2m,wind_speed_10m,weather_code&daily=weather_code,temperature_2m_max,temperature_2m_min&timezone=Europe/London');
                const data = await response.json();
                
                const temp = Math.round(data.current.temperature_2m);
                const wind = data.current.wind_speed_10m;
                const code = data.current.weather_code;
                
                document.getElementById('weatherTemp').textContent = temp + '¬∞';
                document.getElementById('weatherDesc').textContent = getWeatherDesc(code);
                document.getElementById('windSpeed').textContent = wind;
                document.getElementById('visibility').textContent = wind > 20 ? 'Poor' : 'Good';
                document.getElementById('elevation').textContent = temp < 0 ? 'Icy' : 'Clear';
                
                document.getElementById('weatherWidget').style.display = 'block';
            } catch (e) {
                console.error('Weather fetch failed:', e);
            }
        }

        function getWeatherDesc(code) {
            const codes = {
                0: 'Clear sky',
                1: 'Mainly clear',
                2: 'Partly cloudy',
                3: 'Overcast',
                45: 'Foggy',
                48: 'Depositing rime fog',
                51: 'Light drizzle',
                53: 'Moderate drizzle',
                55: 'Dense drizzle',
                61: 'Slight rain',
                63: 'Moderate rain',
                65: 'Heavy rain',
                71: 'Slight snow',
                73: 'Moderate snow',
                75: 'Heavy snow',
                95: 'Thunderstorm'
            };
            return codes[code] || 'Unknown';
        }

        // Profile Functions
        function loadUserProfile() {
            if (state.user.name) {
                document.getElementById('userNameInput').value = state.user.name;
                document.getElementById('profileName').textContent = state.user.name;
            }
        }

        function saveProfile() {
            const name = document.getElementById('userNameInput').value;
            if (name) {
                state.user.name = name;
                localStorage.setItem('user', JSON.stringify(state.user));
                document.getElementById('profileName').textContent = name;
                alert('Profile saved!');
            }
        }

        function updateProfileView() {
            const bagged = state.bagged.length;
            const percent = Math.round((bagged / 284) * 100);
            
            document.getElementById('profileBagged').textContent = bagged;
            document.getElementById('profilePercent').textContent = percent + '%';
            
            // Update rank
            let rank = 'Novice Walker';
            if (bagged >= 10) rank = 'Hill Walker';
            if (bagged >= 50) rank = 'Seasoned Munroist';
            if (bagged >= 100) rank = 'Veteran Bagger';
            if (bagged >= 200) rank = 'Highland Master';
            if (bagged >= 284) rank = 'Munro Legend';
            
            document.getElementById('profileRank').textContent = rank;
            document.getElementById('userLevel').textContent = rank.split(' ')[0];
            document.getElementById('levelBadge').textContent = 'Lv.' + Math.floor(bagged / 10 + 1);
        }

        // Achievements
        function renderAchievements() {
            const achievements = [
                {id: 'first', icon: 'ü•æ', title: 'First Steps', desc: 'Bag your first Munro', check: () => state.bagged.length >= 1},
                {id: 'ten', icon: 'üîü', title: 'Double Digits', desc: 'Bag 10 Munros', check: () => state.bagged.length >= 10},
                {id: 'fifty', icon: 'üèîÔ∏è', title: 'Half Century', desc: 'Bag 50 Munros', check: () => state.bagged.length >= 50},
                {id: 'hundred', icon: 'üíØ', title: 'Century Club', desc: 'Bag 100 Munros', check: () => state.bagged.length >= 100},
                {id: 'bennevis', icon: 'üëë', title: 'Top of Britain', desc: 'Bag Ben Nevis', check: () => state.bagged.includes(1)},
                {id: 'skye', icon: 'üè¥Û†ÅßÛ†Å¢Û†Å≥Û†Å£Û†Å¥Û†Åø', title: 'Skye Warrior', desc: 'Bag 5 Skye Munros', check: () => {
                    const skyeIds = [17, 18, 19, 20, 21, 22, 23, 24];
                    return skyeIds.filter(id => state.bagged.includes(id)).length >= 5;
                }},
                {id: 'photographer', icon: 'üì∑', title: 'Summit Photographer', desc: 'Upload 5 photos', check: () => {
                    return Object.values(state.photos).flat().length >= 5;
                }},
                {id: 'compleat', icon: 'üèÜ', title: 'The Compleatist', desc: 'Bag all 284 Munros', check: () => state.bagged.length >= 284}
            ];
            
            document.getElementById('achievementsList').innerHTML = achievements.map(a => {
                const unlocked = a.check();
                return `
                    <div class="achievement ${unlocked ? 'unlocked' : ''}">
                        <div class="achievement-icon">${unlocked ? a.icon : 'üîí'}</div>
                        <div class="achievement-title">${a.title}</div>
                        <div class="achievement-desc">${a.desc}</div>
                    </div>
                `;
            }).join('');
        }

        function checkAchievements() {
            renderAchievements();
        }

        // Leaderboard (Simulated with local data)
        function renderLeaderboard() {
            const mockUsers = [
                {name: 'Hamish the Highlander', bagged: 284, avatar: 'üè¥Û†ÅßÛ†Å¢Û†Å≥Û†Å£Û†Å¥Û†Åø'},
                {name: 'Glen Coe George', bagged: 156, avatar: '‚õ∞Ô∏è'},
                {name: 'Skye Sarah', bagged: 142, avatar: 'ü¶Ö'},
                {name: state.user.name || 'You', bagged: state.bagged.length, avatar: state.user.avatar, isYou: true},
                {name: 'Ben Nevis Bill', bagged: 89, avatar: 'üëë'},
                {name: 'Torridon Tom', bagged: 67, avatar: 'ü¶å'}
            ].sort((a, b) => b.bagged - a.bagged);
            
            document.getElementById('leaderboardList').innerHTML = mockUsers.map((u, i) => `
                <div class="leaderboard-item" style="${u.isYou ? 'border-color: var(--accent); background: rgba(212, 175, 55, 0.1);' : ''}">
                    <div class="leaderboard-rank ${i === 0 ? 'gold' : i === 1 ? 'silver' : i === 2 ? 'bronze' : ''}">
                        ${i + 1}
                    </div>
                    <div class="leaderboard-info">
                        <div class="leaderboard-name">${u.avatar} ${u.name} ${u.isYou ? '(You)' : ''}</div>
                        <div class="leaderboard-stats">${u.bagged} Munros bagged</div>
                    </div>
                    <div class="leaderboard-score">${Math.round((u.bagged/284)*100)}%</div>
                </div>
            `).join('');
        }

        // Stats
        function updateStats() {
            const bagged = state.bagged.length;
            const totalHeight = state.bagged.reduce((sum, id) => {
                const m = munrosData.find(x => x.id === id);
                return sum + (m ? m.height : 0);
            }, 0);
            
            document.getElementById('baggedCount').textContent = bagged;
            document.getElementById('totalHeight').textContent = totalHeight.toLocaleString() + 'm';
            
            const percent = Math.round((bagged / 284) * 100);
            document.getElementById('progressBar').style.width = percent + '%';
            document.getElementById('progressBar').textContent = percent + '%';
            
            // Calculate streak (simplified - consecutive days with bags)
            document.getElementById('currentStreak').textContent = bagged > 0 ? Math.floor(bagged / 5) + 1 : 0;
        }

        // Close modal on outside click
        document.getElementById('munroModal').addEventListener('click', (e) => {
            if (e.target === document.getElementById('munroModal')) {
                closeModal();
            }
        });

        // Service Worker for PWA
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('data:text/javascript;base64,' + btoa(`
                self.addEventListener('install', e => e.waitUntil(self.skipWaiting()));
                self.addEventListener('activate', e => e.waitUntil(self.clients.claim()));
                self.addEventListener('fetch', e => e.respondWith(fetch(e.request).catch(() => new Response('Offline'))));
            `)).catch(() => console.log('SW registration skipped'));
        }
    </script>
</body>
</html>
